## 소스코드의 타입

소스코드를 4가지 타입으로 구분. 4가지 타입 모두 실행 컨텍스트를 생성

- 전역 코드
    - 전역 변수를 관리하기 위해 전역 스코프 생성
- 함수 코드
- eval 코드
- 모듈 코드

각 소스코드를 평가하여 4가지 타입의 실행 컨텍스트를 생성함

## 소스코드의 평가와 실행

자바스크립트는 소스코드를 ‘평가’와 ‘실행’ 과정으로 나누어 처리

평가

- 실행 컨텍스트를 생성
- 변수, 함수 등의 선언문만 먼저 실행하여 생성된 변수나 함수 식별자를 키로 실행 컨텍스트가 관리하는 스코프에 등록

실행

- 평가 과정이 끝나면 선언문을 제외하고 순차적으로 실행 → 런타임 시작
- 변수나 함수의 참조는 실행 컨텍스트가 관리하는 스코프에서 검색해서 취득
- 변수 값의 변경 등 소스코드의 실행 결과는 실행 컨텍스트가 관리하는 스코프에 등록

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/97131488-82da-4165-a5d5-b3a1144f5180/f1b08dcc-feb2-4bf8-a3b4-ccb3c6f9362c/Untitled.png)

예시

1. 평가
    1. 변수 선언문 var x;를 실행
    2. 식별자 x를 실행 컨텍스트가 관리하는 스코프에 등록. 값은 undefined로 초기화
2. 실행
    1. x = 1;만 실행
    2. x 변수가 선언되었는지 실행 컨텍스트가 관리하는 스코프에서 확인.
        1. 있다면 → 값을 할당하고 할당 결과를 실행 컨텍스트에 등록

## 실행 컨텍스트의 역할

1. 전역 코드 평가
    1. 변수 선언문, 함수 선언문 처리
2. 전역 코드 실행
    1. 전역 코드가 순차적으로 실행
    2. 함수가 호출되면 전역 코드 실행을 일시 중단하고 함수 내부로 진입
3. 함수 코드 평가
    1. 매개변수와 지역 변수 선언문 처리
    2. arguments 객체 생성, this 바인딩
4. 함수 코드 실행
    1. 함수 내 코드를 순차적으로 실행
    2. 실행이 종료되면 함수 호출 이전으로 되돌아가 전역 코드 실행

코드가 실행되려면 스코프, 식별자, 코드 실행 순서 등의 관리 필요

실행 컨텍스트는 소스코드를 실행하는 데 필요한 환경 제공, 코드의 실행 결과를 관리하는 영역

## 실행 컨텍스트 스택

실행 컨텍스트는 스택 자료구조로 관리된다.

전역 실행 컨텍스트에서 함수 호출 되면 함수 실행 컨텍스트가 쌓이게 된다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/97131488-82da-4165-a5d5-b3a1144f5180/bf5c9ed5-49e6-4f8e-814a-2fda6db11c85/Untitled.png)

실행 컨텍스트 스택은 코드의 실행 순서를 관리

실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 현재 실행 중인 코드의 실행 컨텍스트

## 렉시컬 환경

식별자와 식별자에 바인딩된 값, 상위 스코프에 대한 참조를 기록하는 자료구조. 실행 컨텍스트를 구성하는 컴포넌트

key, value 쌍을 갖는 객체 형태의 스코프를 생성하여 식별자를 키로 등록, 식별자에 바인딩된 값을 관리

LexicalEnvironment(L.E.) / VariableEnvironment(V.E.)

- 생성 초기에 둘 다 하나의 동일한 렉시컬 환경 참조

L.E.

- 환경 레코드(EnvironmentRecord)
    - 스코프에 포함된 식별자를 등록하고 등록된 식별자에 바인딩된 값을 관리
- 외부 렉시컬 환경 참조(Outer Lexical Environment Reference)
    - 상위 스코프. 상위 코드의 렉시컬 환경

## 실행 컨텍스트의 생성과 식별자 검색 과정

1. 전역 객체 생성
    1. 전역 코드가 평가되기 이전에 생성
2. 전역 코드 평가
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/97131488-82da-4165-a5d5-b3a1144f5180/21aaf228-169d-4494-ab38-6b307ee682c6/Untitled.png)
    
    1. 전역 실행 컨텍스트 생성: 비어있는 실행 컨텍스트를 실행 컨텍스트 스택에 푸시
    2. 전역 렉시컬 환경 생성: 전역 실행 컨텍스트에 바인딩
        1. 전역 환경 레코드 생성 (EnvironmentRecord): 전역 스코프, 빌트인 객체 등
            1. 객체 환경 레코드 생성: var 전역 변수, 전역 함수, 표준 빌트인 객체
            2. 선언적 환경 레코드 생성: let, const 전역 변수
        2. this 바인딩: 전역 객체
        3. 외부 렉시컬 환경 참조 결정 (Outer L.E. Reference): null
3. 전역 코드 실행
4. 함수 코드 평가
    1. 함수 실행 컨텍스트 생성
    2. 함수 렉시컬 환경 생성
        1. 함수 환경 레도드 생성
        2. this 바인딩
    3. 외부 렉시컬 환경 참조 결정: 전역 렉시컬 환경의 참조 할당
5. 함수 코드 실행

## 실행 컨텍스트와 블록 레벨 스코프

if, for 문 등의 블록문은 코드 블록이 실행되면 코드 블록을 위한 블록 레벨 스코프를 생성

선언적 환경 레코드를 갖는 렉시컬 환경을 새롭게 생성하여 기존의 전역 렉시컬 환경 교체

Outer L.E Reference는 if 문이 실행되기 이전의 전역 렉시컬 환경을 가리킴
